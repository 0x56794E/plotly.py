import plotly
from plotly.graph_objs import *
import plotly.tools as tls
from nose.tools import raises
import numpy as np


@raises(Exception)
def unequal_xy_length():
    data = tls.Quiver(x=[1, 2], y=[1], u=[1, 2], v=[1, 2])


@raises(Exception)
def unequal_uv_length():
    data = tls.Quiver(x=[1, 2], y=[1, 3], u=[1], v=[1, 2])


@raises(Exception)
def test_wrong_kwarg():
    data = tls.Quiver(stuff='not gonna work')


def test_one_arrow():
    nan = np.nan
    trace1 = Scatter(
            x=[0., 1., nan],
            y=[0., 1., nan],
            mode='lines',
            name='Barb',
            line=Line(color='rgb(114, 132, 314)', width=1)
            )
    trace2 = Scatter(
            x=[0.82069826, 1., 0.61548617, nan],
            y=[0.61548617,  1.,  0.82069826, nan],
            mode='lines',
            name='Arrow',
            line=Line(color='rgb(114, 132, 314)', width=1)
            )
    expected = Data([trace1, trace2])

    data = tls.Quiver(x=[0], y=[0], u=[1], v=[1], scale=1)

    np.testing.assert_almost_equal(data[0]['y'], expected[0]['y'])
    np.testing.assert_almost_equal(data[0]['x'], expected[0]['x'])
    np.testing.assert_almost_equal(data[1]['y'], expected[1]['y'])
    np.testing.assert_almost_equal(data[1]['x'], expected[1]['x'])
    assert data[0].keys() == expected[0].keys()


def test_complicated():
    nan = np.nan
    trace1 = Scatter(
            x=[0.0, 0.1, nan, 0.0, 0.1, nan, 0.0, 0.1, nan, 0.0, 0.1, nan, 0.0, 0.1, nan, 0.0, 0.1, nan, 0.0, 0.1, nan, 0.5, 0.5877582561890373, nan, 0.5, 0.5877582561890373, nan, 0.5, 0.5877582561890373, nan, 0.5, 0.5877582561890373, nan, 0.5, 0.5877582561890373, nan, 0.5, 0.5877582561890373, nan, 0.5, 0.5877582561890373, nan, 1.0, 1.0540302305868139, nan, 1.0, 1.0540302305868139, nan, 1.0, 1.0540302305868139, nan, 1.0, 1.0540302305868139, nan, 1.0, 1.0540302305868139, nan, 1.0, 1.0540302305868139, nan, 1.0, 1.0540302305868139, nan, 1.5, 1.5070737201667703, nan, 1.5, 1.5070737201667703, nan, 1.5, 1.5070737201667703, nan, 1.5, 1.5070737201667703, nan, 1.5, 1.5070737201667703, nan, 1.5, 1.5070737201667703, nan, 1.5, 1.5070737201667703, nan, 2.0, 1.9583853163452858, nan, 2.0, 1.9583853163452858, nan, 2.0, 1.9583853163452858, nan, 2.0, 1.9583853163452858, nan, 2.0, 1.9583853163452858, nan, 2.0, 1.9583853163452858, nan, 2.0, 1.9583853163452858, nan, 2.5, 2.4198856384453067, nan, 2.5, 2.4198856384453067, nan, 2.5, 2.4198856384453067, nan, 2.5, 2.4198856384453067, nan, 2.5, 2.4198856384453067, nan, 2.5, 2.4198856384453067, nan, 2.5, 2.4198856384453067, nan, 3.0, 2.9010007503399553, nan, 3.0, 2.9010007503399553, nan, 3.0, 2.9010007503399553, nan, 3.0, 2.9010007503399553, nan, 3.0, 2.9010007503399553, nan, 3.0, 2.9010007503399553, nan, 3.0, 2.9010007503399553, nan],
            y=[0.0, 0.0, nan, 0.5, 0.5479425538604203, nan, 1.0, 1.0841470984807897, nan, 1.5, 1.5997494986604055, nan, 2.0, 2.0909297426825684, nan, 2.5, 2.5598472144103956, nan, 3.0, 3.0141120008059867, nan, 0.0, 0.0, nan, 0.5, 0.5479425538604203, nan, 1.0, 1.0841470984807897, nan, 1.5, 1.5997494986604055, nan, 2.0, 2.0909297426825684, nan, 2.5, 2.5598472144103956, nan, 3.0, 3.0141120008059867, nan, 0.0, 0.0, nan, 0.5, 0.5479425538604203, nan, 1.0, 1.0841470984807897, nan, 1.5, 1.5997494986604055, nan, 2.0, 2.0909297426825684, nan, 2.5, 2.5598472144103956, nan, 3.0, 3.0141120008059867, nan, 0.0, 0.0, nan, 0.5, 0.5479425538604203, nan, 1.0, 1.0841470984807897, nan, 1.5, 1.5997494986604055, nan, 2.0, 2.0909297426825684, nan, 2.5, 2.5598472144103956, nan, 3.0, 3.0141120008059867, nan, 0.0, 0.0, nan, 0.5, 0.5479425538604203, nan, 1.0, 1.0841470984807897, nan, 1.5, 1.5997494986604055, nan, 2.0, 2.0909297426825684, nan, 2.5, 2.5598472144103956, nan, 3.0, 3.0141120008059867, nan, 0.0, 0.0, nan, 0.5, 0.5479425538604203, nan, 1.0, 1.0841470984807897, nan, 1.5, 1.5997494986604055, nan, 2.0, 2.0909297426825684, nan, 2.5, 2.5598472144103956, nan, 3.0, 3.0141120008059867, nan, 0.0, 0.0, nan, 0.5, 0.5479425538604203, nan, 1.0, 1.0841470984807897, nan, 1.5, 1.5997494986604055, nan, 2.0, 2.0909297426825684, nan, 2.5, 2.5598472144103956, nan, 3.0, 3.0141120008059867, nan],
            mode='lines',
            name='Barb',
            line=Line(color='rgb(114, 132, 314)', width=2)
            )
    trace2 = Scatter(
            x=[0.07690301168721783, 0.1, 0.07690301168721783, nan, 0.08148971695413129, 0.1, 0.07231630642030437, nan, 0.0849534368047658, 0.1, 0.06885258656966987, nan, 0.08644613181823306, 0.1, 0.06735989155620262, nan, 0.08560233819567775, 0.1, 0.06820368517875791, nan, 0.08262864604423276, 0.1, 0.0711773773302029, nan, 0.07825311891371131, 0.1, 0.07555290446072435, nan, 0.5674887420135539, 0.5877582561890373, 0.5674887420135539, nan, 0.5720754472804674, 0.5877582561890373, 0.5629020367466405, nan, 0.5755391671311019, 0.5877582561890373, 0.559438316896006, nan, 0.5770318621445691, 0.5877582561890373, 0.5579456218825387, nan, 0.5761880685220139, 0.5877582561890373, 0.558789415505094, nan, 0.5732143763705688, 0.5877582561890373, 0.561763107656539, nan, 0.5688388492400475, 0.5877582561890373, 0.5661386347870605, nan, 1.0415508745428081, 1.0540302305868139, 1.0415508745428081, nan, 1.0461375798097217, 1.0540302305868139, 1.0369641692758949, nan, 1.049601299660356, 1.0540302305868139, 1.0335004494252602, nan, 1.0510939946738234, 1.0540302305868139, 1.032007754411793, nan, 1.0502502010512682, 1.0540302305868139, 1.0328515480343483, nan, 1.047276508899823, 1.0540302305868139, 1.0358252401857933, nan, 1.0429009817693018, 1.0540302305868139, 1.0402007673163147, nan, 1.5054399038465724, 1.5070737201667703, 1.5054399038465724, nan, 1.510026609113486, 1.5070737201667703, 1.500853198579659, nan, 1.5134903289641204, 1.5070737201667703, 1.4973894787290245, nan, 1.5149830239775877, 1.5070737201667703, 1.4958967837155572, nan, 1.5141392303550323, 1.5070737201667703, 1.4967405773381126, nan, 1.5111655382035873, 1.5070737201667703, 1.4997142694895575, nan, 1.5067900110730659, 1.5070737201667703, 1.504089796620079, nan, 1.9679970549654164, 1.9583853163452858, 1.9679970549654164, nan, 1.97258376023233, 1.9583853163452858, 1.963410349698503, nan, 1.9760474800829644, 1.9583853163452858, 1.9599466298478685, nan, 1.9775401750964317, 1.9583853163452858, 1.9584539348344012, nan, 1.9766963814738763, 1.9583853163452858, 1.9592977284569564, nan, 1.9737226893224313, 1.9583853163452858, 1.9622714206084015, nan, 1.9693471621919099, 1.9583853163452858, 1.966646947738923, nan, 2.438389643170454, 2.4198856384453067, 2.438389643170454, nan, 2.4429763484373677, 2.4198856384453067, 2.4338029379035406, nan, 2.4464400682880023, 2.4198856384453067, 2.4303392180529064, nan, 2.4479327633014694, 2.4198856384453067, 2.428846523039439, nan, 2.447088969678914, 2.4198856384453067, 2.4296903166619943, nan, 2.444115277527469, 2.4198856384453067, 2.4326640088134392, nan, 2.4397397503969476, 2.4198856384453067, 2.4370395359439607, nan, 2.9238665954636778, 2.9010007503399553, 2.9238665954636778, nan, 2.9284533007305913, 2.9010007503399553, 2.9192798901967643, nan, 2.931917020581226, 2.9010007503399553, 2.91581617034613, nan, 2.933409715594693, 2.9010007503399553, 2.9143234753326626, nan, 2.9325659219721376, 2.9010007503399553, 2.915167268955218, nan, 2.9295922298206927, 2.9010007503399553, 2.918140961106663, nan, 2.925216702690171, 2.9010007503399553, 2.9225164882371844, nan],
            y=[-0.009567085809127246, 0.0, 0.009567085809127246, nan, 0.5273021819893026, 0.5479425538604203, 0.546436353607557, nan, 1.0551445671700093, 1.0841470984807897, 1.0742787387882637, nan, 1.5671432828036256, 1.5997494986604055, 1.58627745442188, nan, 2.0603606248332054, 2.0909297426825684, 2.07949479645146, nan, 2.5364572244833736, 2.5598472144103956, 2.555591396101628, nan, 3.001285467820001, 3.0141120008059867, 3.0204196394382556, nan, -0.008395907674198922, 0.0, 0.008395907674198922, nan, 0.5284733601242309, 0.5479425538604203, 0.5452651754726286, nan, 1.0563157453049374, 1.0841470984807897, 1.0731075606533353, nan, 1.568314460938554, 1.5997494986604055, 1.5851062762869517, nan, 2.0615318029681338, 2.0909297426825684, 2.0783236183165315, nan, 2.537628402618302, 2.5598472144103956, 2.5544202179666997, nan, 3.002456645954929, 3.0141120008059867, 3.0192484613033272, nan, -0.0051691185231098, 0.0, 0.0051691185231098, nan, 0.5317001492753199, 0.5479425538604203, 0.5420383863215396, nan, 1.0595425344560265, 1.0841470984807897, 1.0698807715022463, nan, 1.571541250089643, 1.5997494986604055, 1.5818794871358626, nan, 2.064758592119223, 2.0909297426825684, 2.0750968291654424, nan, 2.540855191769391, 2.5598472144103956, 2.5511934288156106, nan, 3.0056834351060187, 3.0141120008059867, 3.016021672152238, nan, -0.0006767488782524558, 0.0, 0.0006767488782524558, nan, 0.5361925189201773, 0.5479425538604203, 0.5375460166766822, nan, 1.0640349041008839, 1.0841470984807897, 1.065388401857389, nan, 1.5760336197345004, 1.5997494986604055, 1.5773871174910052, nan, 2.06925096176408, 2.0909297426825684, 2.070604459520585, nan, 2.5453475614142484, 2.5598472144103956, 2.5467010591707533, nan, 3.010175804750876, 3.0141120008059867, 3.011529302507381, nan, 0.0039813124944433585, 0.0, -0.0039813124944433585, nan, 0.5408505802928731, 0.5479425538604203, 0.5328879553039864, nan, 1.0686929654735797, 1.0841470984807897, 1.060730340484693, nan, 1.5806916811071963, 1.5997494986604055, 1.5727290561183094, nan, 2.073909023136776, 2.0909297426825684, 2.065946398147889, nan, 2.5500056227869443, 2.5598472144103956, 2.5420429977980574, nan, 3.0148338661235714, 3.0141120008059867, 3.006871241134685, nan, 0.007664609715371957, 0.0, -0.007664609715371957, nan, 0.5445338775138017, 0.5479425538604203, 0.5292046580830578, nan, 1.0723762626945084, 1.0841470984807897, 1.0570470432637644, nan, 1.5843749783281247, 1.5997494986604055, 1.569045758897381, nan, 2.0775923203577045, 2.0909297426825684, 2.0622631009269607, nan, 2.5536889200078727, 2.5598472144103956, 2.538359700577129, nan, 3.0185171633445003, 3.0141120008059867, 3.003187943913756, nan, 0.009471343165368589, 0.0, -0.009471343165368589, nan, 0.5463406109637984, 0.5479425538604203, 0.5273979246330611, nan, 1.074182996144505, 1.0841470984807897, 1.055240309813768, nan, 1.5861817117781214, 1.5997494986604055, 1.5672390254473842, nan, 2.0793990538077014, 2.0909297426825684, 2.0604563674769643, nan, 2.5554956534578697, 2.5598472144103956, 2.536552967127132, nan, 3.0203238967944968, 3.0141120008059867, 3.0013812104637596, nan],
            mode='lines',
            name='Arrow',
            line=Line(color='rgb(114, 132, 314)', width=1)
            )
    expected = Data([trace1, trace2])

    x, y = np.meshgrid(np.arange(0, np.pi, .5), np.arange(0, np.pi, .5))
    u = np.cos(x)
    v = np.sin(y)
    data = tls.Quiver(x, y, u, v, scale=.1, angle=np.pi/8,
                      arrow_scale=.25, barb_width=2)

    # np.testing.assert_almost_equal(data[0]['y'], expected[0]['y'])
    # np.testing.assert_almost_equal(data[0]['x'], expected[0]['x'])
    np.testing.assert_almost_equal(data[1]['y'], expected[1]['y'])
    np.testing.assert_almost_equal(data[1]['x'], expected[1]['x'])
    assert data[0].keys() == expected[0].keys()
