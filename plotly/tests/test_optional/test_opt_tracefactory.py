from unittest import TestCase
from plotly.graph_objs import graph_objs, Line
from plotly.exceptions import PlotlyError

import plotly.tools as tls
import math
from nose.tools import raises

import numpy as np


class TestQuiver(TestCase):

    def test_numpy_quiver(self):

        # check that quiver results as expected when x, y, u and v are
        # defined with numpy (typical user use)

        x, y = np.meshgrid(np.arange(0, 2, .2), np.arange(0, 2, .2))
        u = np.cos(x) * y
        v = np.sin(x) * y
        quiver = tls.TraceFactory.create_quiver(x, y, u, v,
                                                arrow_scale=.09,
                                                angle=math.pi / 6,
                                                line=Line(width=2))
        expected_quiver = {
            'y': [0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.0, 0.0, None, 0.20000000000000001, 0.20000000000000001, None, 0.20000000000000001, 0.20397338661590123, None, 0.20000000000000001, 0.20778836684617302, None, 0.20000000000000001, 0.21129284946790072, None, 0.20000000000000001, 0.21434712181799048, None, 0.20000000000000001, 0.21682941969615793, None, 0.20000000000000001, 0.21864078171934453, None, 0.20000000000000001, 0.21970899459976923, None, 0.20000000000000001, 0.21999147206083011, None, 0.20000000000000001, 0.21947695261756392, None, 0.40000000000000002, 0.40000000000000002, None, 0.40000000000000002, 0.40794677323180245, None, 0.40000000000000002, 0.41557673369234605, None, 0.40000000000000002, 0.42258569893580145, None, 0.40000000000000002, 0.42869424363598096, None, 0.40000000000000002, 0.43365883939231586, None, 0.40000000000000002, 0.43728156343868907, None, 0.40000000000000002, 0.43941798919953845, None, 0.40000000000000002, 0.43998294412166022, None, 0.40000000000000002, 0.43895390523512784, None, 0.60000000000000009, 0.60000000000000009, None, 0.60000000000000009, 0.61192015984770376, None, 0.60000000000000009, 0.62336510053851912, None, 0.60000000000000009, 0.63387854840370217, None, 0.60000000000000009, 0.6430413654539715, None, 0.60000000000000009, 0.65048825908847385, None, 0.60000000000000009, 0.65592234515803371, None, 0.60000000000000009, 0.65912698379930768, None, 0.60000000000000009, 0.65997441618249042, None, 0.60000000000000009, 0.65843085785269184, None, 0.80000000000000004, 0.80000000000000004, None, 0.80000000000000004, 0.8158935464636049, None, 0.80000000000000004, 0.83115346738469209, None, 0.80000000000000004, 0.84517139787160289, None, 0.80000000000000004, 0.85738848727196193, None, 0.80000000000000004, 0.86731767878463173, None, 0.80000000000000004, 0.87456312687737814, None, 0.80000000000000004, 0.8788359783990769, None, 0.80000000000000004, 0.87996588824332045, None, 0.80000000000000004, 0.87790781047025568, None, 1.0, 1.0, None, 1.0, 1.019866933079506, None, 1.0, 1.0389418342308652, None, 1.0, 1.0564642473395036, None, 1.0, 1.0717356090899524, None, 1.0, 1.0841470984807897, None, 1.0, 1.0932039085967227, None, 1.0, 1.0985449729988461, None, 1.0, 1.0999573603041506, None, 1.0, 1.0973847630878195, None, 1.2000000000000002, 1.2000000000000002, None, 1.2000000000000002, 1.2238403196954075, None, 1.2000000000000002, 1.2467302010770382, None, 1.2000000000000002, 1.2677570968074043, None, 1.2000000000000002, 1.286082730907943, None, 1.2000000000000002, 1.3009765181769477, None, 1.2000000000000002, 1.3118446903160674, None, 1.2000000000000002, 1.3182539675986154, None, 1.2000000000000002, 1.3199488323649808, None, 1.2000000000000002, 1.3168617157053837, None, 1.4000000000000001, 1.4000000000000001, None, 1.4000000000000001, 1.4278137063113088, None, 1.4000000000000001, 1.4545185679232113, None, 1.4000000000000001, 1.4790499462753051, None, 1.4000000000000001, 1.5004298527259334, None, 1.4000000000000001, 1.5178059378731057, None, 1.4000000000000001, 1.5304854720354117, None, 1.4000000000000001, 1.5379629621983846, None, 1.4000000000000001, 1.5399403044258109, None, 1.4000000000000001, 1.5363386683229474, None, 1.6000000000000001, 1.6000000000000001, None, 1.6000000000000001, 1.6317870929272098, None, 1.6000000000000001, 1.6623069347693842, None, 1.6000000000000001, 1.6903427957432058, None, 1.6000000000000001, 1.7147769745439239, None, 1.6000000000000001, 1.7346353575692635, None, 1.6000000000000001, 1.7491262537547563, None, 1.6000000000000001, 1.7576719567981538, None, 1.6000000000000001, 1.7599317764866409, None, 1.6000000000000001, 1.7558156209405114, None, 1.8, 1.8, None, 1.8, 1.8357604795431111, None, 1.8, 1.870095301615557, None, 1.8, 1.9016356452111065, None, 1.8, 1.9291240963619141, None, 1.8, 1.9514647772654214, None, 1.8, 1.9677670354741008, None, 1.8, 1.9773809513979228, None, 1.8, 1.9799232485474709, None, 1.8, 1.9752925735580753, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.0, 0.0, 0.0, None, 0.1991, 0.20000000000000001, 0.20090000000000002, None, 0.20278163185848563, 0.20397338661590123, 0.20454575169859987, None, 0.20635236883272037, 0.20778836684617302, 0.20801027862192556, None, 0.20966985690765361, 0.21129284946790072, 0.21115546101449104, None, 0.21260183830267676, 0.21434712181799048, 0.21385591037950166, None, 0.21503142417197255, 0.21682941969615793, 0.21600396832253518, None, 0.21686175459393375, 0.21864078171934453, 0.21751399855199177, None, 0.21801986007057847, 0.21970899459976923, 0.21832580092779891, None, 0.21845957059116597, 0.21999147206083011, 0.21840701145102365, None, 0.21816335628482725, 0.21947695261756392, 0.2177543925143797, None, 0.3982, 0.40000000000000002, 0.40180000000000005, None, 0.40556326371697127, 0.40794677323180245, 0.40909150339719974, None, 0.41270473766544075, 0.41557673369234605, 0.41602055724385112, None, 0.41933971381530721, 0.42258569893580145, 0.42231092202898207, None, 0.42520367660535352, 0.42869424363598096, 0.42771182075900332, None, 0.43006284834394509, 0.43365883939231586, 0.43200793664507037, None, 0.43372350918786751, 0.43728156343868907, 0.43502799710398354, None, 0.43603972014115694, 0.43941798919953845, 0.43665160185559782, None, 0.43691914118233194, 0.43998294412166022, 0.43681402290204729, None, 0.4363267125696545, 0.43895390523512784, 0.43550878502875939, None, 0.59730000000000005, 0.60000000000000009, 0.60270000000000012, None, 0.60834489557545701, 0.61192015984770376, 0.61363725509579969, None, 0.61905710649816115, 0.62336510053851912, 0.62403083586577679, None, 0.62900957072296082, 0.63387854840370217, 0.63346638304347314, None, 0.63780551490803028, 0.6430413654539715, 0.64156773113850507, None, 0.64509427251591767, 0.65048825908847385, 0.64801190496760563, None, 0.65058526378180137, 0.65592234515803371, 0.65254199565597548, None, 0.65405958021173538, 0.65912698379930768, 0.65497740278339667, None, 0.65537871177349794, 0.65997441618249042, 0.655221034353071, None, 0.6544900688544818, 0.65843085785269184, 0.65326317754313912, None, 0.7964, 0.80000000000000004, 0.80360000000000009, None, 0.81112652743394253, 0.8158935464636049, 0.81818300679439948, None, 0.82540947533088149, 0.83115346738469209, 0.83204111448770224, None, 0.83867942763061443, 0.84517139787160289, 0.84462184405796414, None, 0.85040735321070704, 0.85738848727196193, 0.85542364151800665, None, 0.86012569668789018, 0.86731767878463173, 0.86401587329014073, None, 0.86744701837573501, 0.87456312687737814, 0.87005599420796709, None, 0.87207944028231388, 0.8788359783990769, 0.87330320371119563, None, 0.87383828236466388, 0.87996588824332045, 0.87362804580409459, None, 0.87265342513930899, 0.87790781047025568, 0.87101757005751879, None, 0.99550000000000005, 1.0, 1.0044999999999999, None, 1.0139081592924282, 1.019866933079506, 1.0227287584929992, None, 1.0317618441636018, 1.0389418342308652, 1.0400513931096278, None, 1.048349284538268, 1.0564642473395036, 1.055777305072455, None, 1.0630091915133837, 1.0717356090899524, 1.0692795518975082, None, 1.0751571208598627, 1.0841470984807897, 1.0800198416126761, None, 1.0843087729696688, 1.0932039085967227, 1.0875699927599589, None, 1.0900993003528923, 1.0985449729988461, 1.0916290046389945, None, 1.0922978529558298, 1.0999573603041506, 1.0920350572551183, None, 1.0908167814241361, 1.0973847630878195, 1.0887719625718983, None, 1.1946000000000001, 1.2000000000000002, 1.2054000000000002, None, 1.216689791150914, 1.2238403196954075, 1.2272745101915994, None, 1.2381142129963223, 1.2467302010770382, 1.2480616717315536, None, 1.2580191414459216, 1.2677570968074043, 1.2669327660869463, None, 1.2756110298160606, 1.286082730907943, 1.2831354622770101, None, 1.2901885450318353, 1.3009765181769477, 1.2960238099352113, None, 1.3011705275636027, 1.3118446903160674, 1.305083991311951, None, 1.3081191604234708, 1.3182539675986154, 1.3099548055667933, None, 1.3107574235469959, 1.3199488323649808, 1.310442068706142, None, 1.3089801377089636, 1.3168617157053837, 1.3065263550862782, None, 1.3937000000000002, 1.4000000000000001, 1.4063000000000001, None, 1.4194714230093997, 1.4278137063113088, 1.4318202618901992, None, 1.4444665818290428, 1.4545185679232113, 1.4560719503534791, None, 1.4676889983535752, 1.4790499462753051, 1.4780882271014373, None, 1.4882128681187374, 1.5004298527259334, 1.4969913726565116, None, 1.505219969203808, 1.5178059378731057, 1.5120277782577465, None, 1.5180322821575363, 1.5304854720354117, 1.5225979898639423, None, 1.5261390204940493, 1.5379629621983846, 1.5282806064945924, None, 1.5292169941381617, 1.5399403044258109, 1.5288490801571655, None, 1.5271434939937907, 1.5363386683229474, 1.5242807476006577, None, 1.5928, 1.6000000000000001, 1.6072000000000002, None, 1.6222530548678851, 1.6317870929272098, 1.636366013588799, None, 1.650818950661763, 1.6623069347693842, 1.6640822289754045, None, 1.6773588552612289, 1.6903427957432058, 1.6892436881159283, None, 1.7008147064214141, 1.7147769745439239, 1.7108472830360133, None, 1.7202513933757804, 1.7346353575692635, 1.7280317465802815, None, 1.73489403675147, 1.7491262537547563, 1.7401119884159342, None, 1.7441588805646278, 1.7576719567981538, 1.7466064074223913, None, 1.7476765647293278, 1.7599317764866409, 1.7472560916081892, None, 1.745306850278618, 1.7558156209405114, 1.7420351401150376, None, 1.7919, 1.8, 1.8081, None, 1.8250346867263707, 1.8357604795431111, 1.8409117652873987, None, 1.8571713194944832, 1.870095301615557, 1.87209250759733, None, 1.8870287121688825, 1.9016356452111065, 1.9003991491304193, None, 1.9134165447240905, 1.9291240963619141, 1.9247031934155145, None, 1.935282817547753, 1.9514647772654214, 1.9440357149028167, None, 1.9517557913454038, 1.9677670354741008, 1.957625986967926, None, 1.962178740635206, 1.9773809513979228, 1.9649322083501899, None, 1.9661361353204936, 1.9799232485474709, 1.9656631030592127, None, 1.9634702065634453, 1.9752925735580753, 1.9597895326294172, None],
            'x': [0.0, 0.0, None, 0.20000000000000001, 0.20000000000000001, None, 0.40000000000000002, 0.40000000000000002, None, 0.60000000000000009, 0.60000000000000009, None, 0.80000000000000004, 0.80000000000000004, None, 1.0, 1.0, None, 1.2000000000000002, 1.2000000000000002, None, 1.4000000000000001, 1.4000000000000001, None, 1.6000000000000001, 1.6000000000000001, None, 1.8, 1.8, None, 0.0, 0.020000000000000004, None, 0.20000000000000001, 0.21960133155682485, None, 0.40000000000000002, 0.4184212198800577, None, 0.60000000000000009, 0.61650671229819365, None, 0.80000000000000004, 0.81393413418694338, None, 1.0, 1.0108060461173627, None, 1.2000000000000002, 1.2072471550895336, None, 1.4000000000000001, 1.4033993428580049, None, 1.6000000000000001, 1.5994160095539742, None, 1.8, 1.7954559581061382, None, 0.0, 0.040000000000000008, None, 0.20000000000000001, 0.23920266311364968, None, 0.40000000000000002, 0.43684243976011544, None, 0.60000000000000009, 0.63301342459638721, None, 0.80000000000000004, 0.82786826837388672, None, 1.0, 1.0216120922347256, None, 1.2000000000000002, 1.2144943101790671, None, 1.4000000000000001, 1.4067986857160097, None, 1.6000000000000001, 1.5988320191079486, None, 1.8, 1.7909119162122766, None, 0.0, 0.060000000000000012, None, 0.20000000000000001, 0.25880399467047455, None, 0.40000000000000002, 0.45526365964017312, None, 0.60000000000000009, 0.64952013689458077, None, 0.80000000000000004, 0.84180240256082994, None, 1.0, 1.0324181383520883, None, 1.2000000000000002, 1.2217414652686005, None, 1.4000000000000001, 1.4101980285740146, None, 1.6000000000000001, 1.5982480286619227, None, 1.8, 1.7863678743184148, None, 0.0, 0.080000000000000016, None, 0.20000000000000001, 0.27840532622729935, None, 0.40000000000000002, 0.47368487952023086, None, 0.60000000000000009, 0.66602684919277433, None, 0.80000000000000004, 0.85573653674777328, None, 1.0, 1.0432241844694512, None, 1.2000000000000002, 1.2289886203581339, None, 1.4000000000000001, 1.4135973714320194, None, 1.6000000000000001, 1.5976640382158971, None, 1.8, 1.781823832424553, None, 0.0, 0.10000000000000001, None, 0.20000000000000001, 0.29800665778412416, None, 0.40000000000000002, 0.49210609940028854, None, 0.60000000000000009, 0.68253356149096789, None, 0.80000000000000004, 0.86967067093471662, None, 1.0, 1.0540302305868139, None, 1.2000000000000002, 1.2362357754476676, None, 1.4000000000000001, 1.4169967142900242, None, 1.6000000000000001, 1.5970800477698712, None, 1.8, 1.7772797905306914, None, 0.0, 0.12000000000000002, None, 0.20000000000000001, 0.31760798934094903, None, 0.40000000000000002, 0.51052731928034623, None, 0.60000000000000009, 0.69904027378916145, None, 0.80000000000000004, 0.88360480512165995, None, 1.0, 1.0648362767041768, None, 1.2000000000000002, 1.243482930537201, None, 1.4000000000000001, 1.420396057148029, None, 1.6000000000000001, 1.5964960573238454, None, 1.8, 1.7727357486368296, None, 0.0, 0.14000000000000001, None, 0.20000000000000001, 0.33720932089777389, None, 0.40000000000000002, 0.52894853916040396, None, 0.60000000000000009, 0.71554698608735512, None, 0.80000000000000004, 0.89753893930860329, None, 1.0, 1.0756423228215395, None, 1.2000000000000002, 1.2507300856267345, None, 1.4000000000000001, 1.4237954000060338, None, 1.6000000000000001, 1.5959120668778197, None, 1.8, 1.7681917067429678, None, 0.0, 0.16000000000000003, None, 0.20000000000000001, 0.3568106524545987, None, 0.40000000000000002, 0.5473697590404617, None, 0.60000000000000009, 0.73205369838554857, None, 0.80000000000000004, 0.91147307349554652, None, 1.0, 1.0864483689389024, None, 1.2000000000000002, 1.2579772407162679, None, 1.4000000000000001, 1.4271947428640386, None, 1.6000000000000001, 1.5953280764317939, None, 1.8, 1.7636476648491062, None, 0.0, 0.18000000000000002, None, 0.20000000000000001, 0.37641198401142351, None, 0.40000000000000002, 0.56579097892051933, None, 0.60000000000000009, 0.74856041068374224, None, 0.80000000000000004, 0.92540720768248985, None, 1.0, 1.0972544150562651, None, 1.2000000000000002, 1.2652243958058014, None, 1.4000000000000001, 1.4305940857220434, None, 1.6000000000000001, 1.594744085985768, None, 1.8, 1.7591036229552444, None, 0.0, 0.0, 0.0, None, 0.20000000000000001, 0.20000000000000001, 0.20000000000000001, None, 0.40000000000000002, 0.40000000000000002, 0.40000000000000002, None, 0.60000000000000009, 0.60000000000000009, 0.60000000000000009, None, 0.80000000000000004, 0.80000000000000004, 0.80000000000000004, None, 1.0, 1.0, 1.0, None, 1.2000000000000002, 1.2000000000000002, 1.2000000000000002, None, 1.4000000000000001, 1.4000000000000001, 1.4000000000000001, None, 1.6000000000000001, 1.6000000000000001, 1.6000000000000001, None, 1.8, 1.8, 1.8, None, 0.018441154273188015, 0.020000000000000004, 0.018441154273188015, None, 0.21825236135768133, 0.21960133155682485, 0.21789475656225021, None, 0.41733590439350088, 0.4184212198800577, 0.4166349513773453, None, 0.61572831962776153, 0.61650671229819365, 0.61471196317565047, None, 0.81349369639204583, 0.81393413418694338, 0.81220245542842673, None, 1.0107211220630006, 1.0108060461173627, 1.0092064742903464, None, 1.2075211304297611, 1.2072471550895336, 1.2058434600750199, None, 1.4040212950605861, 1.4033993428580049, 1.4022474855466069, None, 1.600361143347276, 1.5994160095539742, 1.5985619108618012, None, 1.7966865939883636, 1.7954559581061382, 1.794933668252783, None, 0.03688230854637603, 0.040000000000000008, 0.03688230854637603, None, 0.23650472271536266, 0.23920266311364968, 0.23578951312450044, None, 0.43467180878700179, 0.43684243976011544, 0.43326990275469068, None, 0.63145663925552287, 0.63301342459638721, 0.62942392635130073, None, 0.82698739278409172, 0.82786826837388672, 0.82440491085685341, None, 1.0214422441260014, 1.0216120922347256, 1.018412948580693, None, 1.2150422608595217, 1.2144943101790671, 1.2116869201500398, None, 1.4080425901211719, 1.4067986857160097, 1.4044949710932135, None, 1.6007222866945519, 1.5988320191079486, 1.5971238217236026, None, 1.7933731879767274, 1.7909119162122766, 1.789867336505566, None, 0.055323462819564045, 0.060000000000000012, 0.055323462819564045, None, 0.25475708407304398, 0.25880399467047455, 0.25368426968675067, None, 0.4520077131805027, 0.45526365964017312, 0.44990485413203596, None, 0.64718495888328431, 0.64952013689458077, 0.64413588952695111, None, 0.8404810891761374, 0.84180240256082994, 0.83660736628527999, None, 1.032163366189002, 1.0324181383520883, 1.0276194228710394, None, 1.2225633912892826, 1.2217414652686005, 1.2175303802250594, None, 1.412063885181758, 1.4101980285740146, 1.4067424566398203, None, 1.6010834300418277, 1.5982480286619227, 1.5956857325854037, None, 1.7900597819650912, 1.7863678743184148, 1.7848010047583489, None, 0.073764617092752061, 0.080000000000000016, 0.073764617092752061, None, 0.27300944543072531, 0.27840532622729935, 0.27157902624900088, None, 0.46934361757400361, 0.47368487952023086, 0.46653980550938129, None, 0.66291327851104564, 0.66602684919277433, 0.65884785270260138, None, 0.85397478556818329, 0.85573653674777328, 0.84880982171370667, None, 1.0428844882520028, 1.0432241844694512, 1.036825897161386, None, 1.2300845217190433, 1.2289886203581339, 1.2233738403000793, None, 1.416085180242344, 1.4135973714320194, 1.4089899421864269, None, 1.6014445733891038, 1.5976640382158971, 1.5942476434472048, None, 1.7867463759534548, 1.781823832424553, 1.7797346730111316, None, 0.092205771365940062, 0.10000000000000001, 0.092205771365940062, None, 0.29126180678840657, 0.29800665778412416, 0.28947378281125102, None, 0.48667952196750447, 0.49210609940028854, 0.48317475688672662, None, 0.67864159813880709, 0.68253356149096789, 0.67355981587825176, None, 0.86746848196022908, 0.86967067093471662, 0.86101227714213335, None, 1.0536056103150033, 1.0540302305868139, 1.0460323714517323, None, 1.2376056521488044, 1.2362357754476676, 1.2292173003750992, None, 1.4201064753029298, 1.4169967142900242, 1.4112374277330337, None, 1.6018057167363795, 1.5970800477698712, 1.5928095543090059, None, 1.7834329699418185, 1.7772797905306914, 1.7746683412639148, None, 0.11064692563912809, 0.12000000000000002, 0.11064692563912809, None, 0.30951416814608795, 0.31760798934094903, 0.30736853937350128, None, 0.50401542636100538, 0.51052731928034623, 0.49980970826407189, None, 0.69436991776656842, 0.69904027378916145, 0.68827177905390202, None, 0.88096217835227497, 0.88360480512165995, 0.87321473257056015, None, 1.0643267323780041, 1.0648362767041768, 1.0552388457420789, None, 1.2451267825785652, 1.243482930537201, 1.2350607604501191, None, 1.4241277703635158, 1.420396057148029, 1.4134849132796403, None, 1.6021668600836554, 1.5964960573238454, 1.5913714651708071, None, 1.7801195639301821, 1.7727357486368296, 1.7696020095166975, None, 0.12908807991231608, 0.14000000000000001, 0.12908807991231608, None, 0.32776652950376928, 0.33720932089777389, 0.32526329593575148, None, 0.52135133075450624, 0.52894853916040396, 0.51644465964141728, None, 0.71009823739432998, 0.71554698608735512, 0.70298374222955251, None, 0.89445587474432076, 0.89753893930860329, 0.88541718799898683, None, 1.0750478544410047, 1.0756423228215395, 1.0644453200324253, None, 1.2526479130083259, 1.2507300856267345, 1.2409042205251388, None, 1.4281490654241018, 1.4237954000060338, 1.4157323988262471, None, 1.6025280034309315, 1.5959120668778197, 1.5899333760326084, None, 1.7768061579185457, 1.7681917067429678, 1.7645356777694805, None, 0.14752923418550412, 0.16000000000000003, 0.14752923418550412, None, 0.3460188908614506, 0.3568106524545987, 0.34315805249800169, None, 0.5386872351480072, 0.5473697590404617, 0.53307961101876256, None, 0.7258265570220912, 0.73205369838554857, 0.71769570540520278, None, 0.90794957113636654, 0.91147307349554652, 0.89761964342741341, None, 1.0857689765040055, 1.0864483689389024, 1.0736517943227719, None, 1.2601690434380868, 1.2579772407162679, 1.2467476806001587, None, 1.4321703604846876, 1.4271947428640386, 1.4179798843728537, None, 1.6028891467782072, 1.5953280764317939, 1.5884952868944096, None, 1.7734927519069097, 1.7636476648491062, 1.7594693460222637, None, 0.16597038845869211, 0.18000000000000002, 0.16597038845869211, None, 0.36427125221913187, 0.37641198401142351, 0.36105280906025189, None, 0.55602313954150795, 0.56579097892051933, 0.54971456239610783, None, 0.74155487664985276, 0.74856041068374224, 0.73240766858085316, None, 0.92144326752841232, 0.92540720768248985, 0.90982209885584009, None, 1.0964900985670061, 1.0972544150562651, 1.0828582686131183, None, 1.2676901738678477, 1.2652243958058014, 1.2525911406751784, None, 1.4361916555452736, 1.4305940857220434, 1.4202273699194605, None, 1.603250290125483, 1.594744085985768, 1.5870571977562107, None, 1.7701793458952733, 1.7591036229552444, 1.7544030142750464, None],
            'line': {'width': 2},
            'type': 'scatter',
            'mode': 'lines', }
        self.assertAlmostEqual(quiver, expected_quiver)


class TestStreamline(TestCase):

    def test_wrong_arrow_scale(self):

        # check for ValueError if arrow_scale is <= 0

        kwargs = {'x': [0, 2], 'y': [0, 2],
                  'u': [[-1, -5], [-1, -5]],
                  'v': [[1, 1], [-3, -3]],
                  'arrow_scale': 0}
        self.assertRaises(ValueError, tls.TraceFactory.create_streamline,
                          **kwargs)

    def test_wrong_density(self):

        # check for ValueError if density is <= 0

        kwargs = {'x': [0, 2], 'y': [0, 2],
                  'u': [[-1, -5], [-1, -5]],
                  'v': [[1, 1], [-3, -3]],
                  'density': 0}
        self.assertRaises(ValueError, tls.TraceFactory.create_streamline,
                          **kwargs)

    def test_uneven_x(self):

        # check for PlotlyError if x is not evenly spaced

        kwargs = {'x': [0, 2, 7, 9], 'y': [0, 2, 4, 6],
                  'u': [[-1, -5], [-1, -5]],
                  'v': [[1, 1], [-3, -3]]}
        self.assertRaises(PlotlyError, tls.TraceFactory.create_streamline,
                          **kwargs)

    def test_uneven_y(self):

        # check for PlotlyError if y is not evenly spaced

        kwargs = {'x': [0, 2, 4, 6], 'y': [1.5, 2, 3, 3.5],
                  'u': [[-1, -5], [-1, -5]],
                  'v': [[1, 1], [-3, -3]]}
        self.assertRaises(PlotlyError, tls.TraceFactory.create_streamline,
                          **kwargs)

    def test_unequal_shape_u(self):

        # check for PlotlyError if u and v are not the same length

        kwargs = {'x': [0, 2, 4, 6], 'y': [1.5, 2, 3, 3.5],
                  'u': [[-1, -5], [-1, -5], [-1, -5]],
                  'v': [[1, 1], [-3, -3]]}
        self.assertRaises(PlotlyError, tls.TraceFactory.create_streamline,
                          **kwargs)


    def test_simple_streamline(self):

        # Need np to check streamline data,
        # this checks that the first 101 x and y values from streamline are
        # what we expect for a simple streamline where:
        # x = np.linspace(-1, 1, 3)
        # y = np.linspace(-1, 1, 3)
        # Y, X = np.meshgrid(x, y)
        # u = X**2
        # v = Y**2
        # u = u.T #transpose
        # v = v.T #transpose

        strmln = tls.TraceFactory.create_streamline(x=[-1., 0., 1.],
                                                    y=[-1., 0., 1.],
                                                    u=[[1., 0., 1.],
                                                       [1., 0., 1.],
                                                       [1., 0., 1.]],
                                                    v=[[1., 1., 1.],
                                                       [0., 0., 0.],
                                                       [1., 1., 1.]])
        expected_strmln_0_100 = {
            'y': [-1.0, -0.9788791845863757, -0.9579399744939614, -0.9371777642073374, -0.9165881396413338, -0.8961668671832106, -0.8759098835283448, -0.8558132862403048, -0.835873324973195, -0.8160863933003534, -0.7964490210989816, -0.7769578674451656, -0.7576097139780906, -0.7384014586961288, -0.7193301101509343, -0.7003927820087748, -0.681586687951103, -0.6629091368888596, -0.64435752846723, -0.6259293488396024, -0.6076221666912738, -0.5894336294951057, -0.5713614599827976, -0.5534034528167977, -0.5355574714490806, -0.5178214451541254, -0.5001933662244311, -0.4826712873178177, -0.4652533189465894, -0.44793762709939944, -0.4307224309873414, -0.4136060009064273, -0.39658665620919065, -0.3796627633786812, -0.3628327341986042, -0.34609502401380254, -0.3294481300756896, -0.31289058996761565, -0.2964209801054992, -0.28003791430937197, -0.2637400424417804, -0.24752604910925968, -0.23139465242334434, -0.21534460281781365, -0.19937468191908325, -0.18348370146685278, -0.1676705022823033, -0.15193395328130999, -0.13627295053029143, -0.1206864163424669, -0.10517329841242584, -0.08973256898704507, -0.07436322407090357, -0.05906428266445696, -0.04383478603333624, -0.028673797007230273, -0.013580399306900914, 0.0014484211645073852, 0.01648792568956914, 0.03159429687713278, 0.04676843461935776, 0.062011259175942746, 0.07732371182540754, 0.09270675554339824, 0.10816137570939799, 0.12368858084331191, 0.1392894033734846, 0.1549649004378033, 0.1707161547196483, 0.1865442753205595, 0.20245039867161063, 0.21843568948560943, 0.23450134175238246, 0.25064857977955146, 0.26687865928136767, 0.2831928685183458, 0.29959252949062387, 0.3160789991881776, 0.33265367090123643, 0.3493179755944802, 0.366073383348855, 0.3829214048751186, 0.39986359310352526, 0.41690154485438513, 0.4340369025945845, 0.4512713562855355, 0.46860664532844054, 0.4860445606132082, 0.5035869466778524, 0.5212357039857456, 0.5389927913286829, 0.5568602283643591, 0.5748400982975623, 0.5929345507151613, 0.6111458045858065, 0.6294761514361948, 0.6479279587167714, 0.6665036733708583, 0.6852058256224467, 0.704037032999252],
            'x': [-1.0, -0.9788791845863756, -0.9579399744939614, -0.9371777642073374, -0.9165881396413338, -0.8961668671832106, -0.8759098835283448, -0.8558132862403048, -0.835873324973195, -0.8160863933003534, -0.7964490210989816, -0.7769578674451656, -0.7576097139780906, -0.7384014586961289, -0.7193301101509344, -0.7003927820087748, -0.6815866879511031, -0.6629091368888596, -0.6443575284672302, -0.6259293488396025, -0.6076221666912739, -0.5894336294951058, -0.5713614599827976, -0.5534034528167978, -0.5355574714490807, -0.5178214451541254, -0.5001933662244312, -0.4826712873178177, -0.4652533189465894, -0.44793762709939944, -0.4307224309873414, -0.4136060009064273, -0.39658665620919065, -0.3796627633786812, -0.3628327341986042, -0.34609502401380254, -0.3294481300756896, -0.31289058996761565, -0.2964209801054992, -0.28003791430937197, -0.2637400424417804, -0.24752604910925968, -0.23139465242334434, -0.21534460281781365, -0.19937468191908325, -0.18348370146685278, -0.1676705022823033, -0.15193395328130999, -0.13627295053029143, -0.1206864163424669, -0.10517329841242584, -0.08973256898704507, -0.07436322407090357, -0.05906428266445696, -0.04383478603333624, -0.028673797007230273, -0.013580399306900914, 0.0014484211645073852, 0.01648792568956914, 0.03159429687713278, 0.04676843461935776, 0.062011259175942746, 0.07732371182540754, 0.09270675554339824, 0.10816137570939799, 0.12368858084331191, 0.1392894033734846, 0.1549649004378033, 0.1707161547196483, 0.1865442753205595, 0.20245039867161063, 0.21843568948560943, 0.23450134175238246, 0.25064857977955146, 0.26687865928136767, 0.2831928685183458, 0.29959252949062387, 0.3160789991881776, 0.33265367090123643, 0.3493179755944802, 0.366073383348855, 0.3829214048751186, 0.39986359310352526, 0.41690154485438513, 0.4340369025945845, 0.4512713562855355, 0.46860664532844054, 0.4860445606132082, 0.5035869466778524, 0.5212357039857456, 0.5389927913286829, 0.5568602283643591, 0.5748400982975623, 0.5929345507151613, 0.6111458045858065, 0.6294761514361948, 0.6479279587167714, 0.6665036733708583, 0.6852058256224467, 0.704037032999252],
            'type': 'scatter',
            'mode': 'lines'
        }
        self.assertEqual(strmln['y'][0:100], expected_strmln_0_100['y'])
        self.assertEqual(strmln['x'][0:100], expected_strmln_0_100['x'])

    def test_numpy_streamline(self):

        # check that streamline results as expected when x, y, u and v are
        # defined with numpy (typical use)

        x = np.linspace(-3, 3, 100)
        y = np.linspace(-3, 3, 100)
        Y, X = np.meshgrid(x, y)
        u = -1 - X**2 + Y
        v = 1 + X - Y**2
        streamline = tls.TraceFactory.create_streamline(x, y, u, v,
                                                        arrow_scale=.1,
                                                        density=3)
        expected_streamline = {
            'y': [0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393049198, 0.0018922002393044757, 0.0018922002393040316, 0.0018922002393022552, 0.0018922002392969262, 0.001892200239281383, 0.0018922002392334214, 0.0018922002390828752, 0.001892200238609476, 0.0018922002371390967, 0.0018922002325685305, 0.001892200218438056, 0.0018922001749084316, 0.0018922000414152151, 0.0018921996341290104, 0.0018921983989277358, 0.0018921946791010669, 0.0018921835702832013, 0.0018921507305122987, 0.0018920548629908218, 0.0018917794342634409, 0.0018910045248765606, 0.0018888860033485777, 0.001883330861293775, 0.00186969877142662, 0.0018400887882492611, 0.001792611800322419, 0.0017993604930395257, 0.0023459865813966196, 0.005768713743637743, 0.02122353426458945, 0.049323537523347394, 0.07755934266944609],
            'x': [1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645543, 1.000918273645544, 1.0009182736455449, 1.0009182736455466, 1.0009182736455546, 1.0009182736455813, 1.00091827364567, 1.0009182736459632, 1.0009182736469233, 1.00091827365008, 1.0009182736604547, 1.000918273694551, 1.000918273806616, 1.000918274174933, 1.0009182753854606, 1.0009182793640328, 1.0009182924401863, 1.000918335416853, 1.0009184766659116, 1.0009189409018102, 1.000920466685284, 1.000925481451195, 1.0009419639631494, 1.0009961490137123, 1.0011745163431298, 1.0017672338974037, 1.0039090426442545, 1.0110879873093834, 1.0202616741544626],
            'type': 'scatter',
            'mode': 'lines'
        }
        self.assertEqual(streamline['y'][0:100], expected_streamline['y'])
        self.assertEqual(streamline['x'][0:100], expected_streamline['x'])
